{
  "version": 3,
  "sources": ["../app/models/tokenUsage.js", "../app/models/tokenSettings.js", "../app/models/tokensContext.js", "../app/hooks/llmBeforeGenerateHandler.js", "../app/hooks/llmAfterGenerateHandler.js", "../app/hooks/chatAfterMessageHandler.js", "../index.js"],
  "sourcesContent": ["/**\n * TokenUsage Model\n *\n * Tracks detailed token usage for each LLM request/response\n * Stores timing metrics, costs, and performance data\n * Uses MasterRecord schema definition pattern\n */\nclass TokenUsage {\n    id(db) {\n        db.integer().primary().auto();\n    }\n\n    chat_id(db) {\n        db.integer().nullable();\n    }\n\n    message_id(db) {\n        db.integer().nullable();\n    }\n\n    user_id(db) {\n        db.integer().nullable();\n    }\n\n    model_id(db) {\n        db.integer().nullable();\n    }\n\n    model_name(db) {\n        db.string().nullable();\n    }\n\n    provider(db) {\n        db.string().nullable();\n    }\n\n    // Token counts\n    prompt_tokens(db) {\n        db.integer().default(0);\n    }\n\n    completion_tokens(db) {\n        db.integer().default(0);\n    }\n\n    total_tokens(db) {\n        db.integer().default(0);\n    }\n\n    // Timing metrics\n    request_start_time(db) {\n        db.integer().nullable(); // Unix timestamp (ms)\n    }\n\n    request_end_time(db) {\n        db.integer().nullable(); // Unix timestamp (ms)\n    }\n\n    duration_ms(db) {\n        db.integer().nullable(); // Total duration in milliseconds\n    }\n\n    tokens_per_second(db) {\n        db.integer().nullable(); // Tokens generated per second\n    }\n\n    // Cost tracking (optional, can be calculated based on model pricing)\n    estimated_cost(db) {\n        db.integer().nullable(); // Estimated cost in USD\n    }\n\n    // Request metadata\n    workspace_id(db) {\n        db.integer().nullable();\n    }\n\n    session_id(db) {\n        db.string().nullable();\n    }\n\n    request_metadata(db) {\n        db.string().nullable(); // JSON string for additional data\n    }\n\n    // Timestamps\n    created_at(db) {\n        db.string().notNullable();\n        db.get(function(value) {\n            if (!value) {\n                return Date.now().toString();\n            } else {\n                return value;\n            }\n        });\n    }\n}\n\nmodule.exports = TokenUsage;\n", "/**\n * TokenSettings Model\n *\n * Global configuration for token limits and policies\n * Uses MasterRecord schema definition pattern\n */\nclass TokenSettings {\n    id(db) {\n        db.integer().primary().auto();\n    }\n\n    // Global token limits\n    global_token_limit(db) {\n        db.integer().nullable(); // Total tokens allowed across all users (null = unlimited)\n    }\n\n    global_limit_period(db) {\n        db.string().default('monthly'); // 'daily', 'weekly', 'monthly', 'yearly'\n    }\n\n    global_limit_enabled(db) {\n        db.integer().default(0); // Boolean: 0 = disabled, 1 = enabled\n    }\n\n    // Per-user token limits\n    per_user_token_limit(db) {\n        db.integer().nullable(); // Tokens per user (null = unlimited)\n    }\n\n    per_user_limit_period(db) {\n        db.string().default('monthly'); // 'daily', 'weekly', 'monthly', 'yearly'\n    }\n\n    per_user_limit_enabled(db) {\n        db.integer().default(0); // Boolean: 0 = disabled, 1 = enabled\n    }\n\n    // Per-chat limits\n    per_chat_token_limit(db) {\n        db.integer().nullable(); // Tokens per chat session (null = unlimited)\n    }\n\n    per_chat_limit_enabled(db) {\n        db.integer().default(0); // Boolean: 0 = disabled, 1 = enabled\n    }\n\n    // Rate limiting\n    rate_limit_enabled(db) {\n        db.integer().default(0); // Boolean: 0 = disabled, 1 = enabled\n    }\n\n    rate_limit_requests(db) {\n        db.integer().default(100); // Max requests per window\n    }\n\n    rate_limit_window(db) {\n        db.integer().default(60); // Window in seconds\n    }\n\n    // Notification settings\n    notify_on_limit_reached(db) {\n        db.integer().default(1); // Send notification when limits are reached\n    }\n\n    notify_threshold(db) {\n        db.integer().default(90); // Notify at X% of limit (e.g., 90%)\n    }\n\n    // Cost tracking\n    track_costs(db) {\n        db.integer().default(0); // Enable cost estimation\n    }\n\n    currency(db) {\n        db.string().default('USD'); // Currency for cost tracking\n    }\n\n    // Timestamps\n    created_at(db) {\n        db.string().notNullable();\n        db.get(function(value) {\n            if (!value) {\n                return Date.now().toString();\n            } else {\n                return value;\n            }\n        });\n    }\n\n    updated_at(db) {\n        db.string().notNullable();\n        db.get(function(value) {\n            if (!value) {\n                return Date.now().toString();\n            } else {\n                return value;\n            }\n        });\n    }\n}\n\nmodule.exports = TokenSettings;\n", "/**\n * Tokens Context - Database context for token analytics operations\n *\n * Provides access to TokenUsage and TokenSettings tables\n * Inherits from masterrecord.context\n */\n\nconst masterrecord = require('masterrecord');\nconst path = require('path');\nconst TokenUsage = require('./tokenUsage');\nconst TokenSettings = require('./tokenSettings');\n\nclass tokensContext extends masterrecord.context {\n    constructor() {\n        super();\n        const pluginEnvPath = path.join(__dirname, '../../config/environments');\n        this.env(pluginEnvPath);\n        \n        // Register TokenUsage model\n        this.dbset(TokenUsage);\n\n        // Register TokenSettings model\n        this.dbset(TokenSettings);\n    }\n}\n\nmodule.exports = tokensContext;\n", "/**\n * Tokens Plugin: LLM_BEFORE_GENERATE Hook Handler\n *\n * This handler intercepts the LLM pipeline before generating a response to:\n * 1. Check if token limits have been exceeded (global, per-user, per-chat)\n * 2. Store request start time for performance metrics\n * 3. Prevent requests if limits are exceeded by throwing an error\n *\n * @param {Object} context - Hook context containing messageHistory and metadata\n * @returns {Object} - Modified context with timing data or throws error if limit exceeded\n */\n\nconst TokensContext = require('../models/tokensContext');\n\nasync function handleLLMBeforeGenerate(context) {\n    const requestStartTime = Date.now();\n\n    try {\n        console.log('\uD83D\uDCCA Tokens Plugin: LLM_BEFORE_GENERATE hook triggered');\n\n        // Extract parameters from hook context\n        const {\n            messageHistory,\n            chatId,\n            workspaceId,\n            modelConfig,\n            modelSettings,\n            userMessageId,\n            currentUser\n        } = context;\n\n        // Initialize tokens context\n        const tokensContext = new TokensContext();\n\n        // Fetch token settings\n        const settings = await tokensContext.TokenSettings.where().single();\n\n        if (!settings) {\n            console.log('\u26A0\uFE0F  Tokens: No settings found, allowing request');\n            return {\n                ...context,\n                _tokenRequestStartTime: requestStartTime\n            };\n        }\n\n        // Check global token limit\n        if (settings.global_limit_enabled) {\n            console.log('\uD83D\uDD0D Tokens: Checking global token limit');\n\n            const periodStart = getPeriodStartTime(settings.global_limit_period);\n\n            const totalUsage = await tokensContext.TokenUsage\n                .where({ created_at: { $gte: periodStart } })\n                .sum('total_tokens');\n\n            if (totalUsage >= settings.global_token_limit) {\n                console.error(`\u274C Tokens: Global token limit exceeded (${totalUsage}/${settings.global_token_limit})`);\n\n                // Throw error to stop LLM request\n                const error = new Error('Global token limit exceeded. Please contact your administrator.');\n                error.code = 'TOKEN_LIMIT_EXCEEDED';\n                error.type = 'global';\n                error.currentUsage = totalUsage;\n                error.limit = settings.global_token_limit;\n                throw error;\n            }\n\n            console.log(`\u2705 Tokens: Global limit check passed (${totalUsage}/${settings.global_token_limit})`);\n        }\n\n        // Check per-user token limit\n        if (settings.per_user_limit_enabled && currentUser) {\n            console.log(`\uD83D\uDD0D Tokens: Checking per-user token limit for user ${currentUser.id}`);\n\n            const periodStart = getPeriodStartTime(settings.per_user_limit_period);\n\n            const userUsage = await tokensContext.TokenUsage\n                .where({\n                    user_id: currentUser.id,\n                    created_at: { $gte: periodStart }\n                })\n                .sum('total_tokens');\n\n            if (userUsage >= settings.per_user_token_limit) {\n                console.error(`\u274C Tokens: Per-user token limit exceeded for user ${currentUser.id} (${userUsage}/${settings.per_user_token_limit})`);\n\n                const error = new Error('Your token limit has been exceeded. Please try again later or contact support.');\n                error.code = 'TOKEN_LIMIT_EXCEEDED';\n                error.type = 'per_user';\n                error.currentUsage = userUsage;\n                error.limit = settings.per_user_token_limit;\n                throw error;\n            }\n\n            console.log(`\u2705 Tokens: Per-user limit check passed (${userUsage}/${settings.per_user_token_limit})`);\n        }\n\n        // Check per-chat token limit\n        if (settings.per_chat_limit_enabled && chatId) {\n            console.log(`\uD83D\uDD0D Tokens: Checking per-chat token limit for chat ${chatId}`);\n\n            const chatUsage = await tokensContext.TokenUsage\n                .where({ chat_id: chatId })\n                .sum('total_tokens');\n\n            if (chatUsage >= settings.per_chat_token_limit) {\n                console.error(`\u274C Tokens: Per-chat token limit exceeded for chat ${chatId} (${chatUsage}/${settings.per_chat_token_limit})`);\n\n                const error = new Error('This chat has exceeded its token limit. Please start a new chat.');\n                error.code = 'TOKEN_LIMIT_EXCEEDED';\n                error.type = 'per_chat';\n                error.currentUsage = chatUsage;\n                error.limit = settings.per_chat_token_limit;\n                throw error;\n            }\n\n            console.log(`\u2705 Tokens: Per-chat limit check passed (${chatUsage}/${settings.per_chat_token_limit})`);\n        }\n\n        console.log('\u2705 Tokens: All limit checks passed, proceeding with LLM request');\n\n        // Return context with request start time attached\n        return {\n            ...context,\n            _tokenRequestStartTime: requestStartTime\n        };\n\n    } catch (error) {\n        // If this is a token limit error, re-throw it to be handled by the system\n        if (error.code === 'TOKEN_LIMIT_EXCEEDED') {\n            throw error;\n        }\n\n        // For other errors, log and allow the request to proceed\n        console.error('\u274C Tokens Plugin: Error in LLM_BEFORE_GENERATE handler:', error.message);\n        console.error(error.stack);\n\n        // Return context with start time even on error\n        return {\n            ...context,\n            _tokenRequestStartTime: requestStartTime\n        };\n    }\n}\n\n/**\n * Get the start timestamp for a given period\n * @param {string} period - 'daily', 'weekly', 'monthly', 'yearly'\n * @returns {number} - Unix timestamp in milliseconds\n */\nfunction getPeriodStartTime(period) {\n    const now = new Date();\n    let periodStart;\n\n    switch (period) {\n        case 'daily':\n            periodStart = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n            break;\n        case 'weekly':\n            const dayOfWeek = now.getDay();\n            periodStart = new Date(now.getFullYear(), now.getMonth(), now.getDate() - dayOfWeek);\n            break;\n        case 'monthly':\n            periodStart = new Date(now.getFullYear(), now.getMonth(), 1);\n            break;\n        case 'yearly':\n            periodStart = new Date(now.getFullYear(), 0, 1);\n            break;\n        default:\n            periodStart = new Date(now.getFullYear(), now.getMonth(), 1); // Default to monthly\n    }\n\n    return periodStart.getTime();\n}\n\nmodule.exports = handleLLMBeforeGenerate;\n", "/**\n * Tokens Plugin: LLM_AFTER_GENERATE Hook Handler\n *\n * This handler runs after the LLM has generated a response to:\n * 1. Capture token usage data (prompt, completion, total tokens)\n * 2. Calculate timing metrics (duration, tokens per second)\n * 3. Save detailed usage data to TokenUsage table for analytics\n *\n * @param {Object} context - Hook context containing response and metadata\n * @returns {Object} - Unmodified context (passes through)\n */\n\nconst TokensContext = require('../models/tokensContext');\nconst TokenUsage = require('../models/tokenUsage');\n\nasync function handleLLMAfterGenerate(context) {\n    try {\n        console.log('\uD83D\uDCCA Tokens Plugin: LLM_AFTER_GENERATE hook triggered');\n\n        // Extract parameters from hook context\n        const {\n            response,\n            prompt,\n            model,\n            metadata,\n            chatId,\n            workspaceId,\n            userMessageId,\n            messageId,\n            currentUser,\n            modelConfig,\n            _tokenRequestStartTime\n        } = context;\n\n        // Validate required data\n        if (!response || !response.usage) {\n            console.log('\u26A0\uFE0F  Tokens: No usage data in response, skipping tracking');\n            return context;\n        }\n\n        // Calculate timing metrics\n        const requestEndTime = Date.now();\n        const durationMs = _tokenRequestStartTime ? requestEndTime - _tokenRequestStartTime : null;\n\n        const { prompt_tokens, completion_tokens, total_tokens } = response.usage;\n\n        // Calculate tokens per second\n        const tokensPerSecond = durationMs ? (total_tokens / (durationMs / 1000)).toFixed(2) : null;\n\n        console.log(`\uD83D\uDCCA Tokens: Usage - Prompt: ${prompt_tokens}, Completion: ${completion_tokens}, Total: ${total_tokens}`);\n        if (durationMs) {\n            console.log(`\u23F1\uFE0F  Tokens: Duration: ${durationMs}ms, Speed: ${tokensPerSecond} tokens/sec`);\n        }\n\n        // Create token usage record\n        const tokensContext = new TokensContext();\n        const tokenUsageRecord = new TokenUsage();\n\n        // Set core identifiers\n        tokenUsageRecord.chat_id = chatId || null;\n        tokenUsageRecord.message_id = messageId || null;\n        tokenUsageRecord.user_id = currentUser ? currentUser.id : null;\n        tokenUsageRecord.workspace_id = workspaceId || null;\n\n        // Set model information\n        tokenUsageRecord.model_id = model?.id || null;\n        tokenUsageRecord.model_name = model?.name || modelConfig?.model || 'unknown';\n        tokenUsageRecord.provider = model?.provider || modelConfig?.provider || 'unknown';\n\n        // Set token counts\n        tokenUsageRecord.prompt_tokens = prompt_tokens || 0;\n        tokenUsageRecord.completion_tokens = completion_tokens || 0;\n        tokenUsageRecord.total_tokens = total_tokens || 0;\n\n        // Set timing metrics\n        tokenUsageRecord.request_start_time = _tokenRequestStartTime || null;\n        tokenUsageRecord.request_end_time = requestEndTime;\n        tokenUsageRecord.duration_ms = durationMs;\n        tokenUsageRecord.tokens_per_second = tokensPerSecond ? parseFloat(tokensPerSecond) : null;\n\n        // Set metadata (optional additional context)\n        if (metadata) {\n            tokenUsageRecord.request_metadata = JSON.stringify({\n                ...metadata,\n                has_workspace: !!workspaceId,\n                user_message_id: userMessageId\n            });\n        }\n\n        // Calculate estimated cost (if cost tracking is enabled)\n        const settings = await tokensContext.TokenSettings.where().single();\n        if (settings && settings.track_costs) {\n            tokenUsageRecord.estimated_cost = calculateEstimatedCost(\n                tokenUsageRecord.model_name,\n                prompt_tokens,\n                completion_tokens,\n                settings.currency\n            );\n        }\n\n        // Save to database\n        await tokensContext.TokenUsage.add(tokenUsageRecord);\n\n        console.log(`\u2705 Tokens: Usage record saved successfully (ID: ${tokenUsageRecord.id})`);\n\n        // Check if we're approaching any limits and should send notifications\n        if (settings) {\n            await checkAndNotifyLimits(tokensContext, settings, currentUser, chatId);\n        }\n\n        // Return unmodified context\n        return context;\n\n    } catch (error) {\n        console.error('\u274C Tokens Plugin: Error in LLM_AFTER_GENERATE handler:', error.message);\n        console.error(error.stack);\n\n        // On error, return unmodified context (fail gracefully)\n        return context;\n    }\n}\n\n/**\n * Calculate estimated cost based on model pricing\n * @param {string} modelName - Name of the model used\n * @param {number} promptTokens - Number of prompt tokens\n * @param {number} completionTokens - Number of completion tokens\n * @param {string} currency - Currency for cost calculation\n * @returns {number|null} - Estimated cost in specified currency\n */\nfunction calculateEstimatedCost(modelName, promptTokens, completionTokens, currency = 'USD') {\n    // This is a simplified cost calculator\n    // In production, you would want to maintain a pricing table in the database\n\n    const pricingTable = {\n        'gpt-4': { prompt: 0.03 / 1000, completion: 0.06 / 1000 },\n        'gpt-4-turbo': { prompt: 0.01 / 1000, completion: 0.03 / 1000 },\n        'gpt-3.5-turbo': { prompt: 0.001 / 1000, completion: 0.002 / 1000 },\n        'claude-3-opus': { prompt: 0.015 / 1000, completion: 0.075 / 1000 },\n        'claude-3-sonnet': { prompt: 0.003 / 1000, completion: 0.015 / 1000 },\n        'claude-3-haiku': { prompt: 0.00025 / 1000, completion: 0.00125 / 1000 },\n    };\n\n    const modelKey = Object.keys(pricingTable).find(key => modelName.toLowerCase().includes(key.toLowerCase()));\n\n    if (!modelKey) {\n        return null; // No pricing data available\n    }\n\n    const pricing = pricingTable[modelKey];\n    const cost = (promptTokens * pricing.prompt) + (completionTokens * pricing.completion);\n\n    return parseFloat(cost.toFixed(6));\n}\n\n/**\n * Check if usage is approaching limits and send notifications\n * @param {Object} tokensContext - Database context\n * @param {Object} settings - Token settings\n * @param {Object} currentUser - Current user object\n * @param {number} chatId - Current chat ID\n */\nasync function checkAndNotifyLimits(tokensContext, settings, currentUser, chatId) {\n    if (!settings.notify_on_limit_reached) {\n        return;\n    }\n\n    const threshold = settings.notify_threshold / 100; // Convert percentage to decimal\n\n    // Check global limit\n    if (settings.global_limit_enabled && settings.global_token_limit) {\n        const periodStart = getPeriodStartTime(settings.global_limit_period);\n        const totalUsage = await tokensContext.TokenUsage\n            .where({ created_at: { $gte: periodStart } })\n            .sum('total_tokens');\n\n        const usagePercent = totalUsage / settings.global_token_limit;\n\n        if (usagePercent >= threshold) {\n            console.log(`\u26A0\uFE0F  Tokens: Global usage at ${(usagePercent * 100).toFixed(1)}% of limit`);\n            // TODO: Trigger notification system\n        }\n    }\n\n    // Check per-user limit\n    if (settings.per_user_limit_enabled && settings.per_user_token_limit && currentUser) {\n        const periodStart = getPeriodStartTime(settings.per_user_limit_period);\n        const userUsage = await tokensContext.TokenUsage\n            .where({\n                user_id: currentUser.id,\n                created_at: { $gte: periodStart }\n            })\n            .sum('total_tokens');\n\n        const usagePercent = userUsage / settings.per_user_token_limit;\n\n        if (usagePercent >= threshold) {\n            console.log(`\u26A0\uFE0F  Tokens: User ${currentUser.id} usage at ${(usagePercent * 100).toFixed(1)}% of limit`);\n            // TODO: Trigger notification system\n        }\n    }\n}\n\n/**\n * Get the start timestamp for a given period\n * @param {string} period - 'daily', 'weekly', 'monthly', 'yearly'\n * @returns {number} - Unix timestamp in milliseconds\n */\nfunction getPeriodStartTime(period) {\n    const now = new Date();\n    let periodStart;\n\n    switch (period) {\n        case 'daily':\n            periodStart = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n            break;\n        case 'weekly':\n            const dayOfWeek = now.getDay();\n            periodStart = new Date(now.getFullYear(), now.getMonth(), now.getDate() - dayOfWeek);\n            break;\n        case 'monthly':\n            periodStart = new Date(now.getFullYear(), now.getMonth(), 1);\n            break;\n        case 'yearly':\n            periodStart = new Date(now.getFullYear(), 0, 1);\n            break;\n        default:\n            periodStart = new Date(now.getFullYear(), now.getMonth(), 1);\n    }\n\n    return periodStart.getTime();\n}\n\nmodule.exports = handleLLMAfterGenerate;\n", "/**\n * Tokens Plugin: CHAT_AFTER_MESSAGE Hook Handler\n *\n * This handler runs after a user message is saved to the database to:\n * 1. Log message-level events for audit trail\n * 2. Update aggregate statistics if needed\n * 3. Trigger any additional message-level tracking\n *\n * Note: Most token tracking happens in LLM_AFTER_GENERATE\n * This hook is mainly for message-level audit trail and events\n *\n * @param {Object} context - Hook context containing message and metadata\n * @returns {void}\n */\n\nasync function handleChatAfterMessage(context) {\n    try {\n        console.log('\uD83D\uDCCA Tokens Plugin: CHAT_AFTER_MESSAGE hook triggered');\n\n        // Extract parameters from hook context\n        const {\n            message,\n            userId,\n            chatId,\n            messageId\n        } = context;\n\n        // Log message event\n        console.log(`\uD83D\uDCDD Tokens: Message saved - Chat: ${chatId}, User: ${userId}, Message: ${messageId}`);\n\n        // This hook is intentionally minimal since detailed token tracking\n        // happens in LLM_AFTER_GENERATE. This is mainly for audit trail.\n\n        // Potential future enhancements:\n        // - Update real-time dashboards\n        // - Trigger webhooks for message events\n        // - Update message counters for rate limiting\n        // - Log to external analytics services\n\n    } catch (error) {\n        console.error('\u274C Tokens Plugin: Error in CHAT_AFTER_MESSAGE handler:', error.message);\n        console.error(error.stack);\n        // Fail gracefully - don't interrupt the chat flow\n    }\n}\n\nmodule.exports = handleChatAfterMessage;\n", "/**\n * Tokens Plugin - Main Entry Point\n *\n * Provides comprehensive token usage analytics and management:\n * - Tracks token usage across all LLM requests\n * - Enforces global, per-user, and per-chat token limits\n * - Provides detailed analytics and cost estimation\n * - Real-time monitoring and notifications\n *\n * Uses: Generic Hooks System\n */\n\n\n// Import hook handlers\nconst llmBeforeGenerateHandler = require('./app/hooks/llmBeforeGenerateHandler');\nconst llmAfterGenerateHandler = require('./app/hooks/llmAfterGenerateHandler');\nconst chatAfterMessageHandler = require('./app/hooks/chatAfterMessageHandler');\n\n/**\n * Load method - called by pluginLoader with API\n * @param {Object} pluginAPI - { hookService, HOOKS, pluginLoader, registerView, registerClientComponent }\n */\n\nfunction load(pluginAPI) {\n  try {\n    const { hookService, HOOKS, registerView, registerClientComponent } = pluginAPI;\n    const master = require('mastercontroller');\n\n     // Register this plugin directory as a component so MasterController can find controllers\n      // This allows the routes to resolve \"api/rag#method\" to this plugin's controllers\n     master.component(\"bb-plugins\", \"tokens-plugin\");\n\n      registerView('tokens-settings', 'admin/tokens/settings/page', {\n        title: 'Token Settings',\n        capability: 'manage_options',\n        icon: 'settings'\n      });\n\n      registerView('tokens-analytics', 'admin/tokens/analytics/page', {\n        title: 'Token Analytics',\n        capability: 'manage_options',\n        icon: 'activity'\n      });\n\n      // Also register admin views as client components for static loading\n      // This enables Next.js to resolve dependencies at build time\n      registerClientComponent('TokenSettingsPage', 'admin/tokens/settings/page.js', {\n        description: 'Token Settings admin page',\n        usage: 'admin-view',\n        viewSlug: 'tokens-settings'\n      });\n      registerClientComponent('TokenAnalyticsPage', 'admin/tokens/analytics/page.js', {\n        description: 'Token Analytics admin page',\n        usage: 'admin-view',\n        viewSlug: 'tokens-analytics'\n      });\n\n\n    // Register all hooks\n    registerHooks(hookService, HOOKS);\n\n\n    console.log('\u2713 Tokens Plugin loaded successfully');\n  } catch (error) {\n    console.error('\u274C Error loading Tokens Plugin:', error.message);\n    console.error(error.stack);\n    throw error;\n  }\n}\n\n/**\n * Activate method - called when plugin is activated\n */\nasync function activate() {\n  try {\n    console.log('\u26A1 Activating Tokens Plugin...');\n    // Additional activation logic if needed\n    console.log('\u2713 Tokens Plugin activated successfully');\n  } catch (error) {\n    console.error('\u274C Error activating Tokens Plugin:', error.message);\n    throw error;\n  }\n}\n\n/**\n * Deactivate method - called when plugin is deactivated\n */\nasync function deactivate() {\n  try {\n    console.log('\uD83D\uDD0C Deactivating Tokens Plugin...');\n    // Cleanup logic if needed\n    console.log('\u2713 Tokens Plugin deactivated successfully');\n  } catch (error) {\n    console.error('\u274C Error deactivating Tokens Plugin:', error.message);\n    throw error;\n  }\n}\n\n\n/**\n * Register all plugin hooks\n */\nfunction registerHooks(hookService, HOOKS) {\n  try {\n    console.log('\uD83E\uDE9D Registering Tokens Plugin hooks...');\n\n    // Register LLM_BEFORE_GENERATE hook - Check token limits before LLM requests\n    hookService.addFilter(HOOKS.LLM_BEFORE_GENERATE, llmBeforeGenerateHandler, 10);\n    console.log('  \u2713 LLM_BEFORE_GENERATE: Check token limits');\n\n    // Register LLM_AFTER_GENERATE hook - Capture token usage after LLM responses\n    hookService.addAction(HOOKS.LLM_AFTER_GENERATE, llmAfterGenerateHandler, 10);\n    console.log('  \u2713 LLM_AFTER_GENERATE: Capture token usage');\n\n    // Register CHAT_AFTER_MESSAGE hook - Log message-level events\n    hookService.addAction(HOOKS.CHAT_AFTER_MESSAGE, chatAfterMessageHandler, 10);\n    console.log('  \u2713 CHAT_AFTER_MESSAGE: Log message events');\n\n    // Register ADMIN_MENU hook - Add admin menu items\n    hookService.addAction(HOOKS.ADMIN_MENU, async (context) => {\n      // Add top-level Tokens menu\n      context.addMenuItem({\n        id: 'tokens',\n        label: 'Tokens',\n        url: '/bb-admin/plugin/tokens-analytics', // WordPress-style: /bb-admin/plugin/[slug]\n        icon: 'Activity',\n        position: 35\n      });\n\n      // Add Analytics submenu\n      context.addSubmenuItem('tokens', {\n        label: 'Analytics',\n        url: '/bb-admin/plugin/tokens-analytics'\n      });\n\n      // Add Settings submenu\n      context.addSubmenuItem('tokens', {\n        label: 'Settings',\n        url: '/bb-admin/plugin/tokens-settings'\n      });\n    }, 10);\n    console.log('  \u2713 ADMIN_MENU: Add admin menu items');\n\n    console.log('\u2713 All Tokens Plugin hooks registered');\n  } catch (error) {\n    console.error('\u274C Error registering hooks:', error.message);\n    throw error;\n  }\n}\n\n\nmodule.exports = { load, activate, deactivate };\n"],
  "mappings": ";;;;;;AAAA;AAAA,6BAAAA,UAAAC,SAAA;AAOA,QAAM,aAAN,MAAiB;AAAA,MACb,GAAG,IAAI;AACH,WAAG,QAAQ,EAAE,QAAQ,EAAE,KAAK;AAAA,MAChC;AAAA,MAEA,QAAQ,IAAI;AACR,WAAG,QAAQ,EAAE,SAAS;AAAA,MAC1B;AAAA,MAEA,WAAW,IAAI;AACX,WAAG,QAAQ,EAAE,SAAS;AAAA,MAC1B;AAAA,MAEA,QAAQ,IAAI;AACR,WAAG,QAAQ,EAAE,SAAS;AAAA,MAC1B;AAAA,MAEA,SAAS,IAAI;AACT,WAAG,QAAQ,EAAE,SAAS;AAAA,MAC1B;AAAA,MAEA,WAAW,IAAI;AACX,WAAG,OAAO,EAAE,SAAS;AAAA,MACzB;AAAA,MAEA,SAAS,IAAI;AACT,WAAG,OAAO,EAAE,SAAS;AAAA,MACzB;AAAA;AAAA,MAGA,cAAc,IAAI;AACd,WAAG,QAAQ,EAAE,QAAQ,CAAC;AAAA,MAC1B;AAAA,MAEA,kBAAkB,IAAI;AAClB,WAAG,QAAQ,EAAE,QAAQ,CAAC;AAAA,MAC1B;AAAA,MAEA,aAAa,IAAI;AACb,WAAG,QAAQ,EAAE,QAAQ,CAAC;AAAA,MAC1B;AAAA;AAAA,MAGA,mBAAmB,IAAI;AACnB,WAAG,QAAQ,EAAE,SAAS;AAAA,MAC1B;AAAA,MAEA,iBAAiB,IAAI;AACjB,WAAG,QAAQ,EAAE,SAAS;AAAA,MAC1B;AAAA,MAEA,YAAY,IAAI;AACZ,WAAG,QAAQ,EAAE,SAAS;AAAA,MAC1B;AAAA,MAEA,kBAAkB,IAAI;AAClB,WAAG,QAAQ,EAAE,SAAS;AAAA,MAC1B;AAAA;AAAA,MAGA,eAAe,IAAI;AACf,WAAG,QAAQ,EAAE,SAAS;AAAA,MAC1B;AAAA;AAAA,MAGA,aAAa,IAAI;AACb,WAAG,QAAQ,EAAE,SAAS;AAAA,MAC1B;AAAA,MAEA,WAAW,IAAI;AACX,WAAG,OAAO,EAAE,SAAS;AAAA,MACzB;AAAA,MAEA,iBAAiB,IAAI;AACjB,WAAG,OAAO,EAAE,SAAS;AAAA,MACzB;AAAA;AAAA,MAGA,WAAW,IAAI;AACX,WAAG,OAAO,EAAE,YAAY;AACxB,WAAG,IAAI,SAAS,OAAO;AACnB,cAAI,CAAC,OAAO;AACR,mBAAO,KAAK,IAAI,EAAE,SAAS;AAAA,UAC/B,OAAO;AACH,mBAAO;AAAA,UACX;AAAA,QACJ,CAAC;AAAA,MACL;AAAA,IACJ;AAEA,IAAAA,QAAO,UAAU;AAAA;AAAA;;;ACjGjB;AAAA,gCAAAC,UAAAC,SAAA;AAMA,QAAM,gBAAN,MAAoB;AAAA,MAChB,GAAG,IAAI;AACH,WAAG,QAAQ,EAAE,QAAQ,EAAE,KAAK;AAAA,MAChC;AAAA;AAAA,MAGA,mBAAmB,IAAI;AACnB,WAAG,QAAQ,EAAE,SAAS;AAAA,MAC1B;AAAA,MAEA,oBAAoB,IAAI;AACpB,WAAG,OAAO,EAAE,QAAQ,SAAS;AAAA,MACjC;AAAA,MAEA,qBAAqB,IAAI;AACrB,WAAG,QAAQ,EAAE,QAAQ,CAAC;AAAA,MAC1B;AAAA;AAAA,MAGA,qBAAqB,IAAI;AACrB,WAAG,QAAQ,EAAE,SAAS;AAAA,MAC1B;AAAA,MAEA,sBAAsB,IAAI;AACtB,WAAG,OAAO,EAAE,QAAQ,SAAS;AAAA,MACjC;AAAA,MAEA,uBAAuB,IAAI;AACvB,WAAG,QAAQ,EAAE,QAAQ,CAAC;AAAA,MAC1B;AAAA;AAAA,MAGA,qBAAqB,IAAI;AACrB,WAAG,QAAQ,EAAE,SAAS;AAAA,MAC1B;AAAA,MAEA,uBAAuB,IAAI;AACvB,WAAG,QAAQ,EAAE,QAAQ,CAAC;AAAA,MAC1B;AAAA;AAAA,MAGA,mBAAmB,IAAI;AACnB,WAAG,QAAQ,EAAE,QAAQ,CAAC;AAAA,MAC1B;AAAA,MAEA,oBAAoB,IAAI;AACpB,WAAG,QAAQ,EAAE,QAAQ,GAAG;AAAA,MAC5B;AAAA,MAEA,kBAAkB,IAAI;AAClB,WAAG,QAAQ,EAAE,QAAQ,EAAE;AAAA,MAC3B;AAAA;AAAA,MAGA,wBAAwB,IAAI;AACxB,WAAG,QAAQ,EAAE,QAAQ,CAAC;AAAA,MAC1B;AAAA,MAEA,iBAAiB,IAAI;AACjB,WAAG,QAAQ,EAAE,QAAQ,EAAE;AAAA,MAC3B;AAAA;AAAA,MAGA,YAAY,IAAI;AACZ,WAAG,QAAQ,EAAE,QAAQ,CAAC;AAAA,MAC1B;AAAA,MAEA,SAAS,IAAI;AACT,WAAG,OAAO,EAAE,QAAQ,KAAK;AAAA,MAC7B;AAAA;AAAA,MAGA,WAAW,IAAI;AACX,WAAG,OAAO,EAAE,YAAY;AACxB,WAAG,IAAI,SAAS,OAAO;AACnB,cAAI,CAAC,OAAO;AACR,mBAAO,KAAK,IAAI,EAAE,SAAS;AAAA,UAC/B,OAAO;AACH,mBAAO;AAAA,UACX;AAAA,QACJ,CAAC;AAAA,MACL;AAAA,MAEA,WAAW,IAAI;AACX,WAAG,OAAO,EAAE,YAAY;AACxB,WAAG,IAAI,SAAS,OAAO;AACnB,cAAI,CAAC,OAAO;AACR,mBAAO,KAAK,IAAI,EAAE,SAAS;AAAA,UAC/B,OAAO;AACH,mBAAO;AAAA,UACX;AAAA,QACJ,CAAC;AAAA,MACL;AAAA,IACJ;AAEA,IAAAA,QAAO,UAAU;AAAA;AAAA;;;ACrGjB;AAAA,gCAAAC,UAAAC,SAAA;AAOA,QAAM,eAAe,QAAQ,cAAc;AAC3C,QAAM,OAAO,QAAQ,MAAM;AAC3B,QAAM,aAAa;AACnB,QAAM,gBAAgB;AAEtB,QAAM,gBAAN,cAA4B,aAAa,QAAQ;AAAA,MAC7C,cAAc;AACV,cAAM;AACN,cAAM,gBAAgB,KAAK,KAAK,WAAW,2BAA2B;AACtE,aAAK,IAAI,aAAa;AAGtB,aAAK,MAAM,UAAU;AAGrB,aAAK,MAAM,aAAa;AAAA,MAC5B;AAAA,IACJ;AAEA,IAAAA,QAAO,UAAU;AAAA;AAAA;;;AC1BjB;AAAA,0CAAAC,UAAAC,SAAA;AAYA,QAAM,gBAAgB;AAEtB,mBAAe,wBAAwB,SAAS;AAC5C,YAAM,mBAAmB,KAAK,IAAI;AAElC,UAAI;AACA,gBAAQ,IAAI,6DAAsD;AAGlE,cAAM;AAAA,UACF;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,QACJ,IAAI;AAGJ,cAAM,gBAAgB,IAAI,cAAc;AAGxC,cAAM,WAAW,MAAM,cAAc,cAAc,MAAM,EAAE,OAAO;AAElE,YAAI,CAAC,UAAU;AACX,kBAAQ,IAAI,2DAAiD;AAC7D,iBAAO;AAAA,YACH,GAAG;AAAA,YACH,wBAAwB;AAAA,UAC5B;AAAA,QACJ;AAGA,YAAI,SAAS,sBAAsB;AAC/B,kBAAQ,IAAI,+CAAwC;AAEpD,gBAAM,cAAc,mBAAmB,SAAS,mBAAmB;AAEnE,gBAAM,aAAa,MAAM,cAAc,WAClC,MAAM,EAAE,YAAY,EAAE,MAAM,YAAY,EAAE,CAAC,EAC3C,IAAI,cAAc;AAEvB,cAAI,cAAc,SAAS,oBAAoB;AAC3C,oBAAQ,MAAM,+CAA0C,UAAU,IAAI,SAAS,kBAAkB,GAAG;AAGpG,kBAAM,QAAQ,IAAI,MAAM,iEAAiE;AACzF,kBAAM,OAAO;AACb,kBAAM,OAAO;AACb,kBAAM,eAAe;AACrB,kBAAM,QAAQ,SAAS;AACvB,kBAAM;AAAA,UACV;AAEA,kBAAQ,IAAI,6CAAwC,UAAU,IAAI,SAAS,kBAAkB,GAAG;AAAA,QACpG;AAGA,YAAI,SAAS,0BAA0B,aAAa;AAChD,kBAAQ,IAAI,4DAAqD,YAAY,EAAE,EAAE;AAEjF,gBAAM,cAAc,mBAAmB,SAAS,qBAAqB;AAErE,gBAAM,YAAY,MAAM,cAAc,WACjC,MAAM;AAAA,YACH,SAAS,YAAY;AAAA,YACrB,YAAY,EAAE,MAAM,YAAY;AAAA,UACpC,CAAC,EACA,IAAI,cAAc;AAEvB,cAAI,aAAa,SAAS,sBAAsB;AAC5C,oBAAQ,MAAM,yDAAoD,YAAY,EAAE,KAAK,SAAS,IAAI,SAAS,oBAAoB,GAAG;AAElI,kBAAM,QAAQ,IAAI,MAAM,gFAAgF;AACxG,kBAAM,OAAO;AACb,kBAAM,OAAO;AACb,kBAAM,eAAe;AACrB,kBAAM,QAAQ,SAAS;AACvB,kBAAM;AAAA,UACV;AAEA,kBAAQ,IAAI,+CAA0C,SAAS,IAAI,SAAS,oBAAoB,GAAG;AAAA,QACvG;AAGA,YAAI,SAAS,0BAA0B,QAAQ;AAC3C,kBAAQ,IAAI,4DAAqD,MAAM,EAAE;AAEzE,gBAAM,YAAY,MAAM,cAAc,WACjC,MAAM,EAAE,SAAS,OAAO,CAAC,EACzB,IAAI,cAAc;AAEvB,cAAI,aAAa,SAAS,sBAAsB;AAC5C,oBAAQ,MAAM,yDAAoD,MAAM,KAAK,SAAS,IAAI,SAAS,oBAAoB,GAAG;AAE1H,kBAAM,QAAQ,IAAI,MAAM,kEAAkE;AAC1F,kBAAM,OAAO;AACb,kBAAM,OAAO;AACb,kBAAM,eAAe;AACrB,kBAAM,QAAQ,SAAS;AACvB,kBAAM;AAAA,UACV;AAEA,kBAAQ,IAAI,+CAA0C,SAAS,IAAI,SAAS,oBAAoB,GAAG;AAAA,QACvG;AAEA,gBAAQ,IAAI,qEAAgE;AAG5E,eAAO;AAAA,UACH,GAAG;AAAA,UACH,wBAAwB;AAAA,QAC5B;AAAA,MAEJ,SAAS,OAAO;AAEZ,YAAI,MAAM,SAAS,wBAAwB;AACvC,gBAAM;AAAA,QACV;AAGA,gBAAQ,MAAM,+DAA0D,MAAM,OAAO;AACrF,gBAAQ,MAAM,MAAM,KAAK;AAGzB,eAAO;AAAA,UACH,GAAG;AAAA,UACH,wBAAwB;AAAA,QAC5B;AAAA,MACJ;AAAA,IACJ;AAOA,aAAS,mBAAmB,QAAQ;AAChC,YAAM,MAAM,oBAAI,KAAK;AACrB,UAAI;AAEJ,cAAQ,QAAQ;AAAA,QACZ,KAAK;AACD,wBAAc,IAAI,KAAK,IAAI,YAAY,GAAG,IAAI,SAAS,GAAG,IAAI,QAAQ,CAAC;AACvE;AAAA,QACJ,KAAK;AACD,gBAAM,YAAY,IAAI,OAAO;AAC7B,wBAAc,IAAI,KAAK,IAAI,YAAY,GAAG,IAAI,SAAS,GAAG,IAAI,QAAQ,IAAI,SAAS;AACnF;AAAA,QACJ,KAAK;AACD,wBAAc,IAAI,KAAK,IAAI,YAAY,GAAG,IAAI,SAAS,GAAG,CAAC;AAC3D;AAAA,QACJ,KAAK;AACD,wBAAc,IAAI,KAAK,IAAI,YAAY,GAAG,GAAG,CAAC;AAC9C;AAAA,QACJ;AACI,wBAAc,IAAI,KAAK,IAAI,YAAY,GAAG,IAAI,SAAS,GAAG,CAAC;AAAA,MACnE;AAEA,aAAO,YAAY,QAAQ;AAAA,IAC/B;AAEA,IAAAA,QAAO,UAAU;AAAA;AAAA;;;AC/KjB;AAAA,yCAAAC,UAAAC,SAAA;AAYA,QAAM,gBAAgB;AACtB,QAAM,aAAa;AAEnB,mBAAe,uBAAuB,SAAS;AAC3C,UAAI;AACA,gBAAQ,IAAI,4DAAqD;AAGjE,cAAM;AAAA,UACF;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,QACJ,IAAI;AAGJ,YAAI,CAAC,YAAY,CAAC,SAAS,OAAO;AAC9B,kBAAQ,IAAI,oEAA0D;AACtE,iBAAO;AAAA,QACX;AAGA,cAAM,iBAAiB,KAAK,IAAI;AAChC,cAAM,aAAa,yBAAyB,iBAAiB,yBAAyB;AAEtF,cAAM,EAAE,eAAe,mBAAmB,aAAa,IAAI,SAAS;AAGpE,cAAM,kBAAkB,cAAc,gBAAgB,aAAa,MAAO,QAAQ,CAAC,IAAI;AAEvF,gBAAQ,IAAI,qCAA8B,aAAa,iBAAiB,iBAAiB,YAAY,YAAY,EAAE;AACnH,YAAI,YAAY;AACZ,kBAAQ,IAAI,mCAAyB,UAAU,cAAc,eAAe,aAAa;AAAA,QAC7F;AAGA,cAAM,gBAAgB,IAAI,cAAc;AACxC,cAAM,mBAAmB,IAAI,WAAW;AAGxC,yBAAiB,UAAU,UAAU;AACrC,yBAAiB,aAAa,aAAa;AAC3C,yBAAiB,UAAU,cAAc,YAAY,KAAK;AAC1D,yBAAiB,eAAe,eAAe;AAG/C,yBAAiB,WAAW,OAAO,MAAM;AACzC,yBAAiB,aAAa,OAAO,QAAQ,aAAa,SAAS;AACnE,yBAAiB,WAAW,OAAO,YAAY,aAAa,YAAY;AAGxE,yBAAiB,gBAAgB,iBAAiB;AAClD,yBAAiB,oBAAoB,qBAAqB;AAC1D,yBAAiB,eAAe,gBAAgB;AAGhD,yBAAiB,qBAAqB,0BAA0B;AAChE,yBAAiB,mBAAmB;AACpC,yBAAiB,cAAc;AAC/B,yBAAiB,oBAAoB,kBAAkB,WAAW,eAAe,IAAI;AAGrF,YAAI,UAAU;AACV,2BAAiB,mBAAmB,KAAK,UAAU;AAAA,YAC/C,GAAG;AAAA,YACH,eAAe,CAAC,CAAC;AAAA,YACjB,iBAAiB;AAAA,UACrB,CAAC;AAAA,QACL;AAGA,cAAM,WAAW,MAAM,cAAc,cAAc,MAAM,EAAE,OAAO;AAClE,YAAI,YAAY,SAAS,aAAa;AAClC,2BAAiB,iBAAiB;AAAA,YAC9B,iBAAiB;AAAA,YACjB;AAAA,YACA;AAAA,YACA,SAAS;AAAA,UACb;AAAA,QACJ;AAGA,cAAM,cAAc,WAAW,IAAI,gBAAgB;AAEnD,gBAAQ,IAAI,uDAAkD,iBAAiB,EAAE,GAAG;AAGpF,YAAI,UAAU;AACV,gBAAM,qBAAqB,eAAe,UAAU,aAAa,MAAM;AAAA,QAC3E;AAGA,eAAO;AAAA,MAEX,SAAS,OAAO;AACZ,gBAAQ,MAAM,8DAAyD,MAAM,OAAO;AACpF,gBAAQ,MAAM,MAAM,KAAK;AAGzB,eAAO;AAAA,MACX;AAAA,IACJ;AAUA,aAAS,uBAAuB,WAAW,cAAc,kBAAkB,WAAW,OAAO;AAIzF,YAAM,eAAe;AAAA,QACjB,SAAS,EAAE,QAAQ,OAAO,KAAM,YAAY,OAAO,IAAK;AAAA,QACxD,eAAe,EAAE,QAAQ,OAAO,KAAM,YAAY,OAAO,IAAK;AAAA,QAC9D,iBAAiB,EAAE,QAAQ,OAAQ,KAAM,YAAY,OAAQ,IAAK;AAAA,QAClE,iBAAiB,EAAE,QAAQ,QAAQ,KAAM,YAAY,QAAQ,IAAK;AAAA,QAClE,mBAAmB,EAAE,QAAQ,OAAQ,KAAM,YAAY,QAAQ,IAAK;AAAA,QACpE,kBAAkB,EAAE,QAAQ,QAAU,KAAM,YAAY,SAAU,IAAK;AAAA,MAC3E;AAEA,YAAM,WAAW,OAAO,KAAK,YAAY,EAAE,KAAK,SAAO,UAAU,YAAY,EAAE,SAAS,IAAI,YAAY,CAAC,CAAC;AAE1G,UAAI,CAAC,UAAU;AACX,eAAO;AAAA,MACX;AAEA,YAAM,UAAU,aAAa,QAAQ;AACrC,YAAM,OAAQ,eAAe,QAAQ,SAAW,mBAAmB,QAAQ;AAE3E,aAAO,WAAW,KAAK,QAAQ,CAAC,CAAC;AAAA,IACrC;AASA,mBAAe,qBAAqB,eAAe,UAAU,aAAa,QAAQ;AAC9E,UAAI,CAAC,SAAS,yBAAyB;AACnC;AAAA,MACJ;AAEA,YAAM,YAAY,SAAS,mBAAmB;AAG9C,UAAI,SAAS,wBAAwB,SAAS,oBAAoB;AAC9D,cAAM,cAAc,mBAAmB,SAAS,mBAAmB;AACnE,cAAM,aAAa,MAAM,cAAc,WAClC,MAAM,EAAE,YAAY,EAAE,MAAM,YAAY,EAAE,CAAC,EAC3C,IAAI,cAAc;AAEvB,cAAM,eAAe,aAAa,SAAS;AAE3C,YAAI,gBAAgB,WAAW;AAC3B,kBAAQ,IAAI,0CAAgC,eAAe,KAAK,QAAQ,CAAC,CAAC,YAAY;AAAA,QAE1F;AAAA,MACJ;AAGA,UAAI,SAAS,0BAA0B,SAAS,wBAAwB,aAAa;AACjF,cAAM,cAAc,mBAAmB,SAAS,qBAAqB;AACrE,cAAM,YAAY,MAAM,cAAc,WACjC,MAAM;AAAA,UACH,SAAS,YAAY;AAAA,UACrB,YAAY,EAAE,MAAM,YAAY;AAAA,QACpC,CAAC,EACA,IAAI,cAAc;AAEvB,cAAM,eAAe,YAAY,SAAS;AAE1C,YAAI,gBAAgB,WAAW;AAC3B,kBAAQ,IAAI,8BAAoB,YAAY,EAAE,cAAc,eAAe,KAAK,QAAQ,CAAC,CAAC,YAAY;AAAA,QAE1G;AAAA,MACJ;AAAA,IACJ;AAOA,aAAS,mBAAmB,QAAQ;AAChC,YAAM,MAAM,oBAAI,KAAK;AACrB,UAAI;AAEJ,cAAQ,QAAQ;AAAA,QACZ,KAAK;AACD,wBAAc,IAAI,KAAK,IAAI,YAAY,GAAG,IAAI,SAAS,GAAG,IAAI,QAAQ,CAAC;AACvE;AAAA,QACJ,KAAK;AACD,gBAAM,YAAY,IAAI,OAAO;AAC7B,wBAAc,IAAI,KAAK,IAAI,YAAY,GAAG,IAAI,SAAS,GAAG,IAAI,QAAQ,IAAI,SAAS;AACnF;AAAA,QACJ,KAAK;AACD,wBAAc,IAAI,KAAK,IAAI,YAAY,GAAG,IAAI,SAAS,GAAG,CAAC;AAC3D;AAAA,QACJ,KAAK;AACD,wBAAc,IAAI,KAAK,IAAI,YAAY,GAAG,GAAG,CAAC;AAC9C;AAAA,QACJ;AACI,wBAAc,IAAI,KAAK,IAAI,YAAY,GAAG,IAAI,SAAS,GAAG,CAAC;AAAA,MACnE;AAEA,aAAO,YAAY,QAAQ;AAAA,IAC/B;AAEA,IAAAA,QAAO,UAAU;AAAA;AAAA;;;ACzOjB;AAAA,yCAAAC,UAAAC,SAAA;AAeA,mBAAe,uBAAuB,SAAS;AAC3C,UAAI;AACA,gBAAQ,IAAI,4DAAqD;AAGjE,cAAM;AAAA,UACF;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,QACJ,IAAI;AAGJ,gBAAQ,IAAI,2CAAoC,MAAM,WAAW,MAAM,cAAc,SAAS,EAAE;AAAA,MAWpG,SAAS,OAAO;AACZ,gBAAQ,MAAM,8DAAyD,MAAM,OAAO;AACpF,gBAAQ,MAAM,MAAM,KAAK;AAAA,MAE7B;AAAA,IACJ;AAEA,IAAAA,QAAO,UAAU;AAAA;AAAA;;;AChCjB,IAAM,2BAA2B;AACjC,IAAM,0BAA0B;AAChC,IAAM,0BAA0B;AAOhC,SAAS,KAAK,WAAW;AACvB,MAAI;AACF,UAAM,EAAE,aAAa,OAAO,cAAc,wBAAwB,IAAI;AACtE,UAAM,SAAS,QAAQ,kBAAkB;AAIxC,WAAO,UAAU,cAAc,eAAe;AAE7C,iBAAa,mBAAmB,8BAA8B;AAAA,MAC5D,OAAO;AAAA,MACP,YAAY;AAAA,MACZ,MAAM;AAAA,IACR,CAAC;AAED,iBAAa,oBAAoB,+BAA+B;AAAA,MAC9D,OAAO;AAAA,MACP,YAAY;AAAA,MACZ,MAAM;AAAA,IACR,CAAC;AAID,4BAAwB,qBAAqB,iCAAiC;AAAA,MAC5E,aAAa;AAAA,MACb,OAAO;AAAA,MACP,UAAU;AAAA,IACZ,CAAC;AACD,4BAAwB,sBAAsB,kCAAkC;AAAA,MAC9E,aAAa;AAAA,MACb,OAAO;AAAA,MACP,UAAU;AAAA,IACZ,CAAC;AAIH,kBAAc,aAAa,KAAK;AAGhC,YAAQ,IAAI,0CAAqC;AAAA,EACnD,SAAS,OAAO;AACd,YAAQ,MAAM,uCAAkC,MAAM,OAAO;AAC7D,YAAQ,MAAM,MAAM,KAAK;AACzB,UAAM;AAAA,EACR;AACF;AAKA,eAAe,WAAW;AACxB,MAAI;AACF,YAAQ,IAAI,oCAA+B;AAE3C,YAAQ,IAAI,6CAAwC;AAAA,EACtD,SAAS,OAAO;AACd,YAAQ,MAAM,0CAAqC,MAAM,OAAO;AAChE,UAAM;AAAA,EACR;AACF;AAKA,eAAe,aAAa;AAC1B,MAAI;AACF,YAAQ,IAAI,yCAAkC;AAE9C,YAAQ,IAAI,+CAA0C;AAAA,EACxD,SAAS,OAAO;AACd,YAAQ,MAAM,4CAAuC,MAAM,OAAO;AAClE,UAAM;AAAA,EACR;AACF;AAMA,SAAS,cAAc,aAAa,OAAO;AACzC,MAAI;AACF,YAAQ,IAAI,8CAAuC;AAGnD,gBAAY,UAAU,MAAM,qBAAqB,0BAA0B,EAAE;AAC7E,YAAQ,IAAI,kDAA6C;AAGzD,gBAAY,UAAU,MAAM,oBAAoB,yBAAyB,EAAE;AAC3E,YAAQ,IAAI,kDAA6C;AAGzD,gBAAY,UAAU,MAAM,oBAAoB,yBAAyB,EAAE;AAC3E,YAAQ,IAAI,iDAA4C;AAGxD,gBAAY,UAAU,MAAM,YAAY,OAAO,YAAY;AAEzD,cAAQ,YAAY;AAAA,QAClB,IAAI;AAAA,QACJ,OAAO;AAAA,QACP,KAAK;AAAA;AAAA,QACL,MAAM;AAAA,QACN,UAAU;AAAA,MACZ,CAAC;AAGD,cAAQ,eAAe,UAAU;AAAA,QAC/B,OAAO;AAAA,QACP,KAAK;AAAA,MACP,CAAC;AAGD,cAAQ,eAAe,UAAU;AAAA,QAC/B,OAAO;AAAA,QACP,KAAK;AAAA,MACP,CAAC;AAAA,IACH,GAAG,EAAE;AACL,YAAQ,IAAI,2CAAsC;AAElD,YAAQ,IAAI,2CAAsC;AAAA,EACpD,SAAS,OAAO;AACd,YAAQ,MAAM,mCAA8B,MAAM,OAAO;AACzD,UAAM;AAAA,EACR;AACF;AAGA,OAAO,UAAU,EAAE,MAAM,UAAU,WAAW;",
  "names": ["exports", "module", "exports", "module", "exports", "module", "exports", "module", "exports", "module", "exports", "module"]
}
